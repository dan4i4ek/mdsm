# AS-Path Prepend

Один из самых частых приёмов – “ухудшение” пути. Нередко бывает так, что через одного провайдера ваши маршруты будут переданы с длиной AS-path больше, чем через другого. Разумеется, BGP выбирает первого, безапелляционно, и только через него будет передавать трафик. Чтобы выровнять ситуацию при анонсировании маршрутов можно добавить лишний “хоп” в AS-Path.

А бывает такая ситуация, что один провайдер предоставляет более широкий канал за небольшие деньги, но при этом путь через него длиннее и весь трафик уходит в другой – дорогой и узкий. Нам эта ситуация невыгодна и мы бы хотели, чтобы узкий канал стал резервным.  
Вот её и разберём. Но придётся взять совершенно вырожденную ситуацию. К примеру, доступ из Балаган Телекома к сети ЛикМиАп.

Вот так выглядит таблица BGP и маршрутизации на провайдере Балаган Телеком в обычной ситуации:

![](https://dan4i4ek.info/src/0_bc5c4_db67f8b7_XL.png)

Если мы хотим ухудшить основной путь \(прямой линк между ними\), то нужно добавить AS в список AS-Path:

```text
router bgp 64500
neighbor 101.0.0.1 route-map AS_PATH_PREP out

route-map AS_PATH_PREP permit 10
set as-path prepend 64500 64500
```

Тогда выглядеть картинка будет так

![](https://dan4i4ek.info/src/0_bc5ef_24b57188_XL.png)

Разумеется, выбирается путь с меньшей длиной AS-Path, то есть через Филькин Сертификат \(AS64502\)

![](https://dan4i4ek.info/src/0_bc67e_b00c0666_XL.png)

Этот маршрут и добавится в таблицу маршрутизации.

Заметим, что обычно в AS-Path добавляют именно свой номер AS. Можно, конечно, и чужую, но вас не поймут в приличном обществе.

Таким образом мы добились того, что трафик пойдёт намеченным нами путём.

Естественно, при падении одного из каналов трафик переключится на второй, независимо от настроенных AS-Path Prepend’ов.

[Конфигурация устройств](https://docs.google.com/document/d/1zWClzNHuSTBm49GPPGGKbol4TH_lwtRy_mJN5xBzpLI/edit?usp=sharing).

