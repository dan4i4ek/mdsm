# Выбор маршрута

Ситуация с маршрутами у нас такая.  
Есть BGP-таблица, в которой хранятся абсолютно все маршруты, полученные от соседей.

![](http://img-fotki.yandex.ru/get/9113/83739833.29/0_bc5d1_4830beaf_XL.png)  
_То есть если есть у нас несколько маршрутов, до сети 100.0.0.0/23, то все они будут в BGP-таблице, независимо от “плохости” оных:_

![](http://img-fotki.yandex.ru/get/6717/83739833.29/0_bc5d2_6ff2d542_XL.png)

А есть знакомая нам таблица маршрутизации, хранящая только лучшие из лучших. Точно также BGP анонсирует не все приходящие маршруты, а только лучшие. То есть от одного соседа вы никогда не получите два маршрута в одну сеть.

Итак, критерии выбора лучших:

1. Максимальное значение Weight \(локально для маршрутизатора, только для Cisco\)
2. Максимальное значение Local Preference \(для всей AS\)
3. Предпочесть локальный маршрут маршрутизатора \(next hop = 0.0.0.0\)
4. Кратчайший путь через автономные системы. \(самый короткий AS\_PATH\)
5. Минимальное значение Origin Code \(IGP &lt; EGP &lt; incomplete\)
6. Минимальное значение MED \(распространяется между автономными системами\)
7. Путь eBGP лучше чем путь iBGP
8. Выбрать путь через ближайшего IGP-соседа

   Если это условие выполнено, то происходит балансировка нагрузки между несколькими равнозначными линками

   Следующие условия могут различаться от вендора к вендору.

9. Выбрать самый старый маршрут для eBGP-пути
10. Выбрать путь через соседа с наименьшим BGP router ID
11. Выбрать путь через соседа с наименьшим IP-адресом

Как видите, очень много критериев выбора. Причём они довольно сложные и с ходу их все понять непросто. Втягивайтесь потихоньку.  
О некоторых упомянутых атрибутах мы поговорим ниже, а конкретно на выборе маршрутов остановимся в отдельной статье.

