# Трансформ-сет

Теперь немного о трансформ-сете и чем отличается ESP от AH. Как будут шифроваться наши данные, идущие через туннель, определяет команда **crypto ipsec transform-set** _**имя**_**сета\_**, после которой идет название протокола, который будет использован \(ESP или AH\) + алгоритм, по которому будет работать протокол. Например, команда **crypto ipsec transform-set SET1 esp-aes** даст понять роутеру, что трансформ-сет с именем “SET1”, если он будет применен, будет работать только по протоколу ESP c шифрованием алгоритмом AES. Ну если с ESP все более-менее понятно, его дело-шифровать \(обеспечивать _конфиденциальность_\), то что такое AH и зачем он вообще нужен? AH обеспечивает _аутентификацию_ данных, то есть дает уверенность, что эти данные пришли именно от того, с кем мы установили связь, и не были изменены по дороге. Если не углубляться в подробности, работает это так: в каждый пакет между заголовком IP и заголовком транспортного уровня вставляется заголовок AH, в котором присутствует:

* информация, по которой получатель может понять, к какой SA относится данный пакет \(т.е., в том числе, по какому алгоритму ему считать хеш для сравнения – MD5 или SHA\)
* так называемый ICV \(Integrity Check Value\), представляющий собой хеш от пакета \(на самом деле, не всего пакета, а неизменяемых в процессе путешествия полей\), который позволяет однозначно убедиться получателю, что этот пакет не изменялся по дороге, путем вычисления хеша от той же информации и сравнения результата со значением этого поля.

