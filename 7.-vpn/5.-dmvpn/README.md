# DMVPN

Апофеоз сегодняшнего выпуска – DMVPN \(Dymamic Multipoint VPN\). До сих пор речь была об универсальных вендоронезависымых вещах. К сожалению, DMVPN – вещь сугубо цисковская и открытых адекватных аналогов пока не имеет \(поправьте, если ошибаюсь\).

В предыдущих частях мы решили проблему с безопасностью передаваемых данных – теперь мы их шифруем – и с IGP – посредством GRE over IPSec мы используем протоколы динамической маршрутизации.  
Осталась последняя проблема – масштабируемость.  
Хорошо, когда у вас вот такая сеточка:

![](http://img-fotki.yandex.ru/get/6426/83739833.23/0_abbd7_9be4baa9_M.jpg)

По два туннеля на каждом узле и всё.  
Добавляем ещё один узел:

![](http://img-fotki.yandex.ru/get/6431/83739833.23/0_abbd6_1cb3ea29_L.jpg)

И ещё один:

![](http://img-fotki.yandex.ru/get/6427/83739833.23/0_abbd5_4fe9491a_XL.jpg)

Нужно уже гораздо больше туннелей для получения полносвязной топологии. Типичная проблема со сложностью m\*\(m-1\)/2.  
Если не использовать Full-Mesh, а обратиться к топологии Hub-and-Spoke с одной центральной точкой, то появляется другая проблема – трафик между любыми филиалами будет проходить через центральный узел.

DMVPN позволяет решить обе проблемы.  
Суть такая: выбирается центральная точка Hub \(или несколько\). Она будет сервером, к которому будут подключаться клиенты \(Spoke\) и получать всю необходимую информацию. При этом:

1\) Данные будут зашифрованы IPSec  
2\) Клиенты могут передавать трафик непосредственно друг другу в обход центрального узла  
3\) Только на центральном узле необходим статический публичный IP-адрес. Удалённые узлы могут иметь динамический адрес и находиться даже за NATом, используя адреса из частных диапазонов \(Технология [NAT Traversal](http://en.wikipedia.org/wiki/NAT_traversal) \). Но при этом возникают ограничения по части динамических туннелей.

Это всё средоточие мощи GRE и IPSec, сдобренное NHRP и IGP.

