# Обнаружение соседей или Auto-Discovery

Ничего нового выдумывать тут не пришлось. Схема обнаружения соседей уже применённая в L3VPN прекрасно работает и здесь.  
Route Target, который является Extended Community — главный признак принадлежности к определённому VSI.  
Грубо говоря — если RT совпадают — значит в одном VSI.  
Строго говоря: Если RT полученного анонса совпадает с настроенным в VSI, значит этот VSI хочет знать информацию из анонса.  
Как и в L3VPN можно гибко организовать взаимодействие между различными VSI. Но так крайне редко кто делает.

**Чуть подробнее**

Каждый VSI имеет свой RT.

В секции BGP для VPLS есть своя Address Family: L2VPN [AFI](http://lookmeup.linkmeup.ru/#term569) \(25\) и VPLS [SAFI](http://lookmeup.linkmeup.ru/#term568) \(65\)  
В ней настраивается соседство с абсолютно всеми PE, которые могут участвовать в каком-либо VPLS-домене. Заметьте, здесь без привязки к конкретному VSI.  
Если используются RR, то соседство поднимается только с ними.

Когда BGP хочет сообщить L2-префикс всем PE данного VSI, он высылает BGP Update всем настроенным здесь соседям, опять же независимо от того, хотят они получать данный префикс или нет. Здесь всё так же, как в L3VPN — там vpnv4-префиксы тоже рассылаются всем PE.  
Когда удалённый PE получает этот BGP Update, он проверяет RT в поле NLRI и сравнивает с теми, которые настроены в его VSI.  
Если совпадение найдено, PE импортирует этот префикс в нужный VSI. Если нет — отбрасывает.  
Вот так и реализован Auto-Discovery.  
То есть это не какая-то отдельная фаза, чтобы выявить всех участников VPLS-домена и составить их список, а просто механизм распознавания свой-чужой по отношению к анонсу.

