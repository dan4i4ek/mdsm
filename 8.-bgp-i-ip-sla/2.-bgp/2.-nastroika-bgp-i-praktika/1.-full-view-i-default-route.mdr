# Full View и Default Route

Говоря о BGP и подключении к провайдерам, нельзя не затронуть эту тему. Когда ЛинкМиАп, имея уже AS и PI-адреса, будет делать стык с Балаган-Телекомом, одним из первых вопросов от них будет: “Фул вью или Дефолт?”. Тут главное не растеряться и не сморозить чепуху.

То, что вы видели до сих пор – это так называемый Full View – маршрутизатор изучает **абсолютно все** маршруты Интернета, пусть даже в нашем случае это пять-шесть штук. В реальности их сейчас больше 400 000. Соответственно от одного провайдера вы получите 400k маршрутов, от второго столько же. Подчас бывает и третий резервный – плюс ещё 400k. Итого больше миллиона.  
Ну не покупать же теперь маленькому недоинтерпрайзу циску старших серий только для этого?

![](http://img-fotki.yandex.ru/get/9259/83739833.29/0_bc63b_5b829aa2_XL.png)  
_\* вывод таблицы маршрутизации с одного из публичных серверов \(дуступен по_ `telnet route-server.ip.att.net`_\)_

На самом деле, далеко не каждому, кто имеет AS, нужен Full View. Обычно для таких компаний, как наша вполне достаточно Default Route, по названиям вполне понятно, чем они отличаются. В последнем случае от каждого провайдера приходит только один маршрут по умолчанию, вместо сотен тысяч специфических \(хотя вообще-то может и вмест**е**\).

Позвольте привести небольшие аргументы в пользу того и другого.

* **Full View**. Вы обладаетe полным чистейшим знанием о структуре Интернета. До любого адреса в Интернете вы можете просмотреть путь от себя:

  ![](http://img-fotki.yandex.ru/get/6719/83739833.29/0_bc637_aedc1ab4_XL.png)

  Вы знаете, какие к нему ведут AS. Через сайт [RIPE](https://stat.ripe.net/13238#tabId=at-a-glance) можно посмотреть какие провайдеры обеспечивают транзит. Вы следите за всеми изменениями. Если вдруг у кого-то что-то упадёт через первый линк \(даже не у вас или у провайдера, а где-то там, дальше\), BGP это отследит и перестроит свою таблицу маршрутизации для передачи данных через второго провайдера.  
  При этом вы очень гибко можете управлять маршрутами, вмешиваясь в стандартную процедуру выбора наилучшего пути.  
  Например, весь трафик на яндекс вы будете пускать через Балаган Телеком, а на гугл через Филькин Сертификат. Это называется **распределением нагрузки**.  
  Достигается это путём настройки, например, приоритетов маршрутов для определённых префиксов.

  Full View обязателен, если ваша АС транзитная, то есть вы собираетесь по BGP подключать к себе ещё клиентов.  
  Платить за все эти плюсы приходится производительностью: высокая утилизация оперативной памяти и весьма долгое изучение маршрутной информации после установления BGP-сессии. Например, после того, как дёрнулся линк с вышестоящим провайдером, полное восстановление может занять несколько минут.

* **Default Route**  
  Ну, во-первых, это, конечно, сильно экономит ресурсы вашего оборудования.  
  Во-вторых, проще в обслуживании, можно сказать. Не нужно по всей своей AS гонять сотни тысяч маршрутов.  
  В-третьих, никакого представления о состоянии интернета и реальной доступности получателей нет – вы просто слепо доверяетесь дефолту, полученному от апстрима. То есть в случае проблемы выше, вы о ней не узнаете и часть сервисов может упасть. Но тут мы надеемся, что у вышестоящих провайдеров надёжность сети на порядки выше и нам не о чем беспокоиться.

  Балансировка и распределение входящего трафика при получении маршрута по умолчанию никак не затрагивается – проблемы те же. А вот с исходящим, конечно, всё, немного иначе, былой гибкости тут уже не будет.

В общем, очень грубый совет прозвучит так:  
Если вы не собираетесь организовывать через себя транзит \(подключать клиентов со своими АС\) и нет нужды в тонком распределении исходящего трафика, то вам хватит Default Route.

Но уж точно нет смысла принимать от одного провайдера Full View, а от другого Default – в этом случае один линк будет всегда простаивать на исходящий трафик, потому что маршрутизатор будет выбирать более специфический путь.

При этом от всех провайдеров вы можете брать Default плюс определённые префиксы \(например, именно этого провайдера\). Таким образом до нужных ресурсов у вас будут специфические маршруты без Full View.

Вот пример настройки передачи Default Route нижестоящему маршрутизатору:

```text
balagan-router(config-router)#neighbor 101.0.0.2 default-originate
```

И вот как после этого выглядит таблица маршрутов на нашем бордере:

![](http://img-fotki.yandex.ru/get/6703/83739833.29/0_bc5c6_a139a044_XL.png)

То есть помимо обычных маршрутов \(Full View\) передаётся ещё маршрут по умолчанию.

> Сейчас вы уже должны начинать догадываться, что Default Route – это не противопоставление Full View. Не обязательно здесь стоит «или то или другое» \(надо бы ввести понятие хили или ксили, как английское XOR\), вы вполне можете использовать Default Route в дополнение к Full View или Default Route и часть каких-то других маршрутов.

[О пользе и вреде полной таблицы BGP](http://telekomza.ru/2011/02/28/o-polze-i-vrede-polnoj-bgp-tablicy/)

