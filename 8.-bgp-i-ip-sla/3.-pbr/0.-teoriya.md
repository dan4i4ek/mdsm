# Теория

В такой ситуации нам приходит на помощь маршрутизация на базе политик ака PBR \(Policy based routing\). Эта технология позволяет нам управлять трафиком, базируясь на следующих признаках пакета:

* Адрес источника \(или комбинация адрес источника-адрес получателя\)
* Информация 7 уровня \(приложений\) OSI
* Интерфейс, в который пришел пакет
* QoS-метки
* Вообще говоря, любая информация, используемая в extended-ACL \(порт источника\получателя, протокол и прочее, в любых комбинациях\). Т.е. если мы можем выделить интересующий нас трафик с помощью расширенного ACL, мы сможем его смаршрутизировать, как нам будет угодно.

Плюсы использования PBR очевидны: невероятная гибкость маршрутизации. Но и минусы тоже присутствуют:

* Все нужно писать руками, отсюда много работы и риск ошибки
* Производительность. На большинстве железок PBR работает медленнее, чем обычный роутинг \(исключение составляют каталисты 6500, к ним есть супервайзер с железной поддержкой PBR\)

Политика, на основе которой осуществляется PBR, создается командой **route map** _**POLICY\_NAME**_, и содержит два раздела:

* Выделение нужного трафика. Осуществляется либо с помощью ACL, либо в зависимости от интерфейса, в который трафик пришел. За это отвечает команда **match** в режиме конфигурации route map
* Применение действия к этому трафику. За это отвечает команда **set**

