# Martini vs. Kompella

В результате, какие преимущества даёт использование BGP Kompella mode перед Martini Mode?

* Auto-Discovery. Нет необходимости на каждом PE настраивать удалённые LDP-сессии со всем участниками этого VPLS-домена. При использовании RR вопрос полной связности совсем отпадает.
* Вместе с Auto-Discovery BGP поддерживает и обмен префиксами/метками. Это обычно ставится в плюс методу, хотя это необходимая функция.

  Здесь, вероятно, лучше заметить, что если у оператора уже есть инфраструктура BGP, то L2VPN сигнализацией через BGP впишется в неё органично.

  А вот если этот протокол до сих пор не использовался, то выглядеть он может, как пятая нога.\* У BGP всё схвачено на предмет Inter-AS VPN. Option C позволит организовать бесшовный \(seamless\) MPLS между различными AS и протянуть через него тысячи PW.

**Однако всё ли так очевидно? Копнём поглубже.**

Междоменные \(Inter-AS\) VPN не такая уж большая сложность для Martini при организации иерархического VPLS — тогда нет нужды создавать полносвязную топологию PE-устройств в VPLS-домене. Про H-VPLS мы ещё [поговорим позже](https://github.com/eucariot/SDSM/tree/1bba87092a55c57ce614dabb1915aa8f1b76f650/12.-mpls-l2vpn/2.-vpls/12.-mpls-l2vpn.md#H-VPLS). Можем вычеркнуть это из его слабых сторон.

Что же касается столь активно эксплуатируемого Auto-Discovery в Kompella, то тут есть два замечания:  
**Во-первых**, уже давно для внедрения конфигурации используются внешние средства. И эти внешние средства могут, проводя анализ конфигурации, находить соседей и готовить скрипты для узлов без ручного труда чёрных инженеров.  
Многие проприетарные системы управления поддерживают этот функционал. А сети, в которых действительно это требуется обычно моновендорные и управляются такими NMS.  
**Во-вторых**, [RFC 4762](https://tools.ietf.org/html/rfc4762) вводит механизм Auto-Discovery в режим Martini. Реализован он может быть через RADIUS или через тот же BGP.  
Например, оборудование cisco позволяет настроить режим LDP + BGP Autodiscovery командой **autodiscovery LDP signaling BGP** в секции **l2vpn vfi**. С одной стороны имеем простой и неизбыточный метод распределения меток, с другой механизм автоматического поиска соседей \(правда секцию BGP придётся оставить\).  
Как бы то ни было у Martini теперь есть решения для задачи обнаружения соседей и ещё одно очко присуждается Гриффиндору.

Вместе с бережным отношением к меткам, простотой конфигурации и отладки, Martini Mode не только не выглядит аутсайдером, но и, вообще-то давно сыскал любовь операторов. И сегодня он занимает подавляющую долю рынка.

Ну и под занавес ещё одна оптимизация VPLS, которая делает жизнь чуточку легче.

