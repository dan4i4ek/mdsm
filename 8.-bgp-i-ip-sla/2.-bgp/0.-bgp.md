# Теория

– Если говорить о OSPF/IS-IS, то это Link-State алгоритмы, которые подразумевают \(внимание!\), что каждый маршрутизатор знает топологию **всей** сети. Представляем себе миллионы маршрутизаторов в Интернете и отказываемся от идеи использовать Link State для этих целей вообще.

> Вообще OSPF при маршрутизации между area'ми является фактически distance vector протоколом. Гипотетически, можно было бы заменить «AS» на «Area» в плане глобальной маршрутизации, но OSPF просто не предназначен для переваривания таких объемов маршрутной информации, да и нельзя выделить в интернете Area 0.

RIP, EIGRP… Кхе-кхе. Ну, тут всё понятно.

– IGP – это нечто интимное и каждому встречному ISP показывать его не стоит. Даже без AS ситуация, когда клиент поднимает IGP с провайдером, крайне редкая \(за исключением L3VPN\). Дело в том, что IGP не имеют достаточно гибкой системы управления маршрутами – для LS-протоколов это вообще знать _всё или ничего_ \(опять же можно фильтровать на границе зоны, но гибкости никакой\).  
В итоге оказывается, что придётся открывать кому-то чужому потаённые части своей приватной сети или настраивать хитрые политики импорта между различными IGP-процессами.  
– В данный момент в интернете более 450 000 маршрутов. Если бы даже OSPF/ISIS могли хранить всю топологию Интернета, представьте сколько времени заняла бы работа алгоритма SPF.  
Вот [наглядный пример](http://habrahabr.ru/company/yandex/blog/126709/), чем может быть опасно использование IGP там, где напрашивается нечто глобальное.  
Поэтому нужен свой специальный протокол для взаимодействия между AS.  
Во-первых, он должен быть **дистанционно-векторным** – это однозначно. Маршрутизатор не должен делать расчёт маршрута до каждой сети в Интернете, он лишь должен выбрать один из нескольких предложенных.  
Во-вторых, он должен иметь очень **гибкую систему фильтрации маршрутов**. Мы должны легко определять, что светить соседям, а что не нужно выносить из избы.  
В-третьих, он должен быть **легко масштабируемым**, иметь **защиту от образования петель** и **систему управления приоритетами маршрутов**.  
В-четвёртых, он должен обладать **высокой стабильностью**. Поскольку данные о маршрутах будут передаваться через среду, которая не всегда может обладать гарантированным качеством \(за стык отвечают по крайней мере две организации\), необходимо исключить возможные потери маршрутной информации.  
Ну и логичное, в-пятых, он должен понимать, что такое AS, отличать свою AS от чужих.

Встречайте: **BGP**.

Вообще описание работы этого поистине грандиозного протокола мы разобьём на две части. И сегодня рассмотрим принципиальные моменты.

BGP делится на IBGP и EBGP.

**IBGP** необходим для передачи BGP-маршрутов внутри одной автономной системы. Да, BGP часто запускается и **внутри** AS, но об этом мы плотненько поговорим в другой раз.  
**EBGP** – это обычный BGP между автономными системами. На нём и остановимся.

![](http://img-fotki.yandex.ru/get/6445/83739833.27/0_b900b_a2e50ef8_L.png)

