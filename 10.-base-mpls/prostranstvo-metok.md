# Пространство меток

Как уже было сказано выше, может существовать 2^20 меток.

Из них несколько зарезервировано:

**0**: _IPv4 Explicit NULL Label_. «Явная пустая метка». Она используется на самом последнем пролёте MPLS — перед Egress LSR — для того, чтобы уведомить его, что эту метку 0 можно снять, не просматривая таблицу меток \(точнее LFIB\).  
Для тех FEC, что зарождаются локально \(directly connected\) Egress LSR выделяет метку 0 и передаёт своим соседям — предпоследним LSR \(Penultimate LSR\).  
При передаче пакета данных предпоследний LSR меняет текущую метку на 0.  
Когда Egress LSR получает пакет, он точно знает, что верхнюю метку нужно просто удалить.

> Так было не всегда. Изначально предлагалось, что метка 0 может быть только на дне стека меток и при получении пакета с такой меткой, LSR должен вообще очистить упоминания об MPLS и начать обрабатывать данные.  
> В какой-то момент теоретики под давлением практиков согласились, что это нерационально и реального применения им придумать не удалось, поэтому отказались от обоих условий.  
> Так что теперь метка 0 не обязательно последняя \(нижняя\) и при операции Pop Label удаляется только она, а нижние остаются и пакет дальше обрабатывается в соответствии с новой верхней меткой.

**1**: Метка _Router Alert Label_ — аналог опции Router Alert в IP — может быть где угодно, кроме дна стека. Когда пакет приходит с такой меткой, он должен быть передан локальному модулю, а дальше он коммутируется в соответствии с меткой, которая была ниже — реальной транспортной, при этом наверх стека снова должна быть добавлена метка 1.

**2**: _IPv6 Explicit NULL Label_ — то же, что и 0, только с поправкой на версию протокола IP.

**3**: _Implicit Null_. Фиктивная метка, которая используется для оптимизации процесса передачи пакета MPLS на Egress LSR. Эта метка может анонсироваться, но никогда не используется в заголовке MPLS реально. Рассмотрим её попозже.

**4-15**: Зарезервированы.

В зависимости от вендора, могут быть зафиксированы и другие значения меток, например, на оборудовании Huawei метки 16-1023 используются для статических LSP, а всё, что выше — в динамических. В Cisco доступные метки начинаются уже с 16-й.

В целом стало понятно, как передаётся трафик и как в этом участвуют метки MPLS.  
Но метки не берутся от балды — никому не нужен дополнительный хаос в преддверии Нового Года. Специальные протоколы распределяют метки между Egress LSR и Ingress LSR, создавая LSP.

