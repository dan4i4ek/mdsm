# Бритва Оккама или отключение ненужных ветвей

После того, как последний клиент в сегменте отказался от подписки, PIM должен отрезать лишнюю ветку RPT.  
Пусть, например, единственный клиент на R4 выключил компьютер. Маршрутизатор по сообщению IGMP Leave или после трёх безответных IGMP Query понимает, что клиентов за FE0/0 больше нет, и отправляет в сторону RP сообщение **PIM Prune**. По формату оно точно такое же, как Join, но выполняет противоположную функцию.  
Адрес назначения также 224.0.0.13, и TTL равен 1.

![PIM Prune](http://img-fotki.yandex.ru/get/9497/83739833.38/0_da325_7e915979_XXL.png)

Но маршрутизатор, получивший PIM Prune, перед тем, как удалить подписку, ждёт некоторое время \(обычно 3 секунды — Join Delay Timer\).  
Это сделано вот для такой ситуации:  
![Prune override](http://img-fotki.yandex.ru/get/9801/83739833.39/0_dd0c2_a1a89fc6_XL.png)  
В одном широковещательном домене 3 маршрутизатора. Один из них стоит выше и именно он передаёт в сегмент мультикастовый трафик. Это R1. Для обоих маршрутизаторов \(R2 и R3\) его OIL содержит только одну запись.  
Если теперь R2 решит отключиться и отправит PIM Prune, то он может подставить своего коллегу R3 — R1 ведь перестанет вещать в интерфейс вообще.  
Так вот, чтобы этого не произошло, R1 и даёт таймаут в 3 секунды. За это время R3 должен успеть среагировать. Учитывая широковещательность сети, он тоже получит Prune от R2 и поэтому, если хочет продолжать получать трафик, он мгновенно отправляет обычный PIM Join в сегмент, уведомляя R1, что не надо удалять интерфейс.

Этот процесс называется — Prune Override. R2 как бы объегорил R1, перехватил инициативу.
